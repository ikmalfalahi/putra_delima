<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daftar Akun | Putera Delima</title>
  <link rel="stylesheet" href="assets/css/daftar.css" />
</head>
<body>
  <div class="login-wrapper">
    <div class="login-card">
      <h2>Buat Akun Baru ‚ú®</h2>
      <p>Daftar untuk menjadi anggota Putera Delima</p>

      <div class="form-group">
        <input type="text" id="nama" placeholder="Nama Lengkap" required />
      </div>

      <div class="form-group">
        <select id="jenis_kelamin" required>
          <option value="">Pilih Jenis Kelamin</option>
          <option value="Laki-laki">Laki-laki</option>
          <option value="Perempuan">Perempuan</option>
        </select>
      </div>

      <div class="form-group">
        <input type="number" id="umur" placeholder="Umur" required />
      </div>

      <div class="form-group">
        <input type="text" id="agama" placeholder="Agama" required />
      </div>

      <div class="form-group">
        <select id="status_hubungan" required>
          <option value="">Status Hubungan</option>
          <option value="Belum Menikah">Belum Menikah</option>
          <option value="Menikah">Menikah</option>
          <option value="Cerai">Cerai</option>
        </select>
      </div>

      <div class="form-group">
        <input type="text" id="blok" placeholder="Blok (contoh: A)" required />
      </div>

      <div class="form-row">
        <input type="text" id="rt" placeholder="RT (contoh: 01)" required />
        <input type="text" id="rw" placeholder="RW (contoh: 02)" required />
      </div>

      <div class="form-group">
        <input type="email" id="email" placeholder="Alamat Email" required />
      </div>

      <div class="form-group password-group">
        <input type="password" id="password" placeholder="Masukkan Kata Sandi" required />
        <span id="toggle-pass">Tampilkan</span>
      </div>

      <button id="daftar-btn">Daftar</button>
      <p id="msg" class="msg"></p>

      <p class="register-text">Sudah punya akun? <a href="login.html">Masuk</a></p>
    </div>
  </div>

  <!-- === Supabase SDK === -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.js"></script>

  <!-- === Supabase Client Setup === -->
  <script>
    const SUPABASE_URL = "https://ubddfvcjbzuicsewohas.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InViZGRmdmNqYnp1aWNzZXdvaGFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE0NjA3NzgsImV4cCI6MjA3NzAzNjc3OH0.zwOBGrk2iekzlMlL2_fOqRqFUaeOCaQR1Km_fAEP7jQ";

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    window.supabase = supabaseClient;
  </script>

  <!-- === Script Daftar === -->
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      console.log("‚úÖ daftar.js dimuat dan DOM siap");

      const daftarBtn = document.getElementById("daftar-btn");
      const msg = document.getElementById("msg");

      if (!daftarBtn) {
        console.error("‚ùå Tombol #daftar-btn tidak ditemukan di halaman!");
        return;
      }

      daftarBtn.addEventListener("click", async () => {
        msg.textContent = "üîÑ Mengirim data pendaftaran...";

        const nama = document.getElementById("nama").value.trim();
        const jenis_kelamin = document.getElementById("jenis_kelamin").value;
        const umur = document.getElementById("umur").value;
        const agama = document.getElementById("agama").value.trim();
        const status_hubungan = document.getElementById("status_hubungan").value;
        const blok = document.getElementById("blok").value.trim();
        const rt = document.getElementById("rt").value.trim();
        const rw = document.getElementById("rw").value.trim();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();

        if (!nama || !jenis_kelamin || !umur || !agama || !status_hubungan || !blok || !rt || !rw || !email || !password) {
          msg.textContent = "‚ö†Ô∏è Semua kolom wajib diisi.";
          return;
        }

        try {
          const { data, error } = await supabase.auth.signUp({
            email,
            password,
            options: {
              data: {
                nama,
                jenis_kelamin,
                umur,
                agama,
                status_hubungan,
                blok,
                rt,
                rw,
                role: "anggota",
                status: "pending",
              },
            },
          });

          if (error) {
            msg.textContent = `‚ùå Gagal mendaftar: ${error.message}`;
            return;
          }

          console.log("‚úÖ Pendaftaran berhasil:", data);
          msg.textContent = "‚úÖ Pendaftaran berhasil! Mengalihkan ke halaman verifikasi...";

          setTimeout(() => {
            window.location.href = "verifikasi_anggota.html";
          }, 1500);
        } catch (err) {
          console.error(err);
          msg.textContent = "‚ùå Terjadi kesalahan tidak terduga.";
        }
      });
    });
  </script>
</body>
</html>
